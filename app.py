import os
import psycopg2
from flask import Flask, request, jsonify
from flask_cors import CORS
from datetime import datetime
from time import sleep

app = Flask(__name__) 

# --- 🎯 您的固定名單 (MASTER ROSTER) ---
MASTER_ROSTER = {
    '1123003': '謝昀臻', 
    '1123025': '陳靖',
    '1123047': '吳昀軒',
    '1123065': '吳玟璇',
    '1123066': '黃建岷',
    '1123090': '歐陽佑昌',
    '1123098': '簡聖修',
    '1123113': '林彥君',
    '1133080': '蘇筠媗',
    '1133081': '廖曉慧',
    '1133082': '黃子銘',
    '1133084': '張仕學',
    '1133085': '黃奕誠',
    '1133086': '林冠宏',
    '1133091': '曾映竹',
    '1133092': '陳俊宇',
    '1133093': '劉兆軒',
    '1133094': '黃威程',
    '1133095': '李潛昕',
    '1133101': '薩滿',
    '1133102': '張昕程',
    '1133103': '王瑞亞',
    '1133104': '毛仁笛',
    '1133105': '雷漢森',
    '1133106': '哈志豪',
    '1133107': '逾明',
    '1133108': '高以理',
    '1133001': '陳儒頡',
    '1133002': '邱浴鈞',
    '1133003': '張羨茿',
    '1133013': '許淞棓',
    '1133014': '張晴媗',
    '1133026': '安祐萱',
    '1133027': '潘玟菱',
    '1133032': '施韋吉',
    '1133033': '葉冠愷',
    '1133035': '李柏諠',
    '1133036': '翁達翰',
    '1133037': '高爾義',
    '1133038': '高睿宏',
    '1133044': '吳育鑫',
    '1133048': '鄭偉民',
    '1133057': '李旻晃',
    '1133058': '潘啟文',
    '1133064': '林書瑋',
    '1133065': '林子琦',
    '1133068': '曾資淵',
    '1133069': '黃宇賢',
    '1133071': '林士欽',
    '1133072': '張家瑋',
    '1133073': '陳志豪',
    '1143001': '楊梓邑',
    '1143002': '楊仁瑋',
    '1143003': '黃映潔',
    '1143021': '張雅珺',
    '1143022': '曹孝弘',
    '1143023': '呂欣澤',
    '1143035': '李思賢',
    '1143036': '張家銓',
    '1143037': '陳嘉瑜',
    '1143042': '林訓平',
    '1143043': '范姜群傑',
    '1143044': '陳梅齡',
    '1143045': '劉宇傑',
    '1143046': '黃冠博',
    '1143048': '張育梓',
    '1143049': '林文澤',
    '1143050': '唐晏鐸',
    '1143051': '柯宜欣',
    '1143055': '陳毅言',
    '1143056': '鄭睦羽',
    '1143057': '彭軒',
    '1143063': '李柏亨',
    '1143064': '歐宜勛',
    '1143065': '林冠甫',
    '1143066': '楊子嫻',
    '1143077': '蔡承恩',
    '1143078': '廖右安',
    '1143085': '王冠中',
    '1143089': '朱婉容',
    '1143090': '張郁閔',
    '1143091': '廖正豪',
    '1143096': '洪德諭',
    '1143097': '王寅兒',
    '1143098': '林品瑜',
    '1143102': '黃端陽',
    '1143103': '朱曜東',
    '1143104': '魏茂屹',
    '1143114': '謝豐安',
    '1143115': '吳東翰',
    '1143119': '張雅筑',
    '1143125': '卜謙學',
    '1143126': '利輝煌',
    '1143127': '涂俊偉',
    '1143128': '李童發',
    '1143129': '洪明翰',
    '1143130': '羅文傑',
    '1143131': '吳曉天',
    '1143132': '楊佳玲',
    '1143133': '李珮安',
}

# 取得資料庫連線字串
DATABASE_URL = os.environ.get('DATABASE_URL')

# CORS 配置，允許您的前端 Render 網址
CORS(app, resources={r"/api/v1/*": {
    "origins": [
        "https://new-5j38.onrender.com",
        "http://localhost:3000",
        "http://localhost:4200"
    ],
    "supports_credentials":